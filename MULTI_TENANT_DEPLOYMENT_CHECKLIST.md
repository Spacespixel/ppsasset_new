# Production VPS Deployment Checklist for PPS Asset

## Pre-Deployment (Do these BEFORE running the script)

### 1. Server Access
- [ ] RDP connection to 103.13.231.222:33899 working
- [ ] Administrator privileges confirmed  
- [ ] Windows Server (2016/2019/2022) confirmed

### 2. Directory Structure Verification
- [ ] Verify existing directory exists: `C:\Production\web\ppsasset.com`
- [ ] Check directory is empty or ready for deployment
- [ ] Verify sufficient disk space (minimum 5GB recommended)

### 3. Current Environment Assessment
- [ ] List existing websites: `Get-Website`
- [ ] List existing app pools: `Get-IISAppPool`  
- [ ] Check standard ports 80/443 availability: `Get-NetTCPConnection -State Listen`
- [ ] Verify MySQL is installed and running
- [ ] Check if domain ppsasset.com is already configured

### 4. Production Configuration
Production deployment uses:
- [ ] **Production Path**: `C:\Production\web\ppsasset.com`
- [ ] **Database Name**: `ppsasset_production_db`
- [ ] **Database User**: `ppsasset_user`
- [ ] **HTTP Port**: `80` (standard web port)
- [ ] **HTTPS Port**: `443` (standard HTTPS port)
- [ ] **Site Name**: `ppsasset.com`
- [ ] **App Pool**: `ppsasset.com_AppPool`
- [ ] **Domain**: `ppsasset.com`

### 4. Database Password
- [ ] Generate strong database password (save securely)
- [ ] Password should contain: uppercase, lowercase, numbers, special characters
- [ ] Minimum 12 characters recommended

## Deployment Process

### 1. Download and Prepare Script
```powershell
# Navigate to deployment directory
cd C:\Deployment

# Download the updated script (replace with actual script)
# Copy deploy-to-vps.ps1 to the server

# Make script executable
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### 2. Run Production Deployment
```powershell
# Production deployment (uses existing directory structure)
.\deploy-to-vps.ps1 -DatabasePassword "YourSecurePasswordHere"

# Production deployment with domain configuration
.\deploy-to-vps.ps1 -DatabasePassword "YourSecurePasswordHere" -DomainName "ppsasset.com"

# Skip installations if already present (faster deployment)
.\deploy-to-vps.ps1 -DatabasePassword "YourSecurePasswordHere" -SkipIISFeatures -SkipDotNetInstall

# Custom configuration (if needed)
.\deploy-to-vps.ps1 -DatabasePassword "YourSecurePasswordHere" -AppPath "C:\Production\web\ppsasset.com" -SiteName "ppsasset.com"
```

### 3. Verify Safety Checks Pass
The script will automatically:
- [ ] Check for naming conflicts
- [ ] Verify port availability  
- [ ] Backup existing IIS configuration
- [ ] Test existing sites remain operational

### 4. Monitor Deployment Progress
Watch for these phases:
- [ ] **Phase 1**: Infrastructure Setup (IIS features, .NET)
- [ ] **Phase 2**: Production Setup (directories, app pool, website, firewall)
- [ ] **Phase 3**: Configuration (settings files, database script)
- [ ] **Phase 4**: Service Startup

## Post-Deployment Steps

### 1. Database Setup
```bash
# Run the generated database script
mysql -u root -p < "C:\Production\web\ppsasset.com\setup_database.sql"

# Verify database was created
mysql -u root -p -e "SHOW DATABASES LIKE 'ppsasset_production_db';"

# Test database user connection
mysql -u ppsasset_user -p ppsasset_production_db
```

### 2. Deploy Application Files
```powershell
# Copy published files to the wwwroot directory
$TargetPath = "C:\Production\web\ppsasset.com\wwwroot"

# Required files to copy:
# - PPSAsset.dll
# - All DLL dependencies
# - appsettings.json (will be generated by script)
# - web.config (will be generated by script) 
# - wwwroot folder with static assets
# - runtimes folder

# Example copy command
Copy-Item -Path "C:\LocalBuild\publish\*" -Destination $TargetPath -Recurse -Force
```

### 3. Initial Testing
```powershell
# Test standard port accessibility
Test-NetConnection -ComputerName localhost -Port 80
Test-NetConnection -ComputerName localhost -Port 443

# Check application pool status
Get-IISAppPool -Name "ppsasset.com_AppPool"

# Check website status  
Get-Website -Name "ppsasset.com"

# Test HTTP response (should return app or error page, not connection refused)
Invoke-WebRequest -Uri "http://localhost" -UseBasicParsing -TimeoutSec 10
```

### 4. Verify Existing Sites Unaffected
```powershell
# List all websites and their status
Get-Website | Format-Table Name, State, PhysicalPath, Bindings -AutoSize

# Test existing sites still respond (replace with actual existing sites)
# Invoke-WebRequest -Uri "http://localhost" -UseBasicParsing -TimeoutSec 10
```

### 5. Configure External Access

#### For Domain-based Access (Primary):
- [ ] Point ppsasset.com DNS A record to `103.13.231.222`
- [ ] Test: `http://ppsasset.com` (standard port 80)
- [ ] Test: `https://ppsasset.com` (after SSL setup)

#### For IP-based Access (Backup):
- Test: `http://103.13.231.222` (if domain binding is configured with host header)
- Note: May not work if site is configured for domain-only binding

### 6. SSL Certificate Setup (Optional but Recommended)

#### Option A: Let's Encrypt (Free)
```powershell
# Install Certbot for IIS
# Configure certificates for both ports and domain
```

#### Option B: Commercial Certificate
- Purchase SSL certificate for ppsasset.com
- Install via IIS Manager
- Bind to website for standard port 443

### 7. Monitoring Setup
```powershell
# Check log files
Get-ChildItem "C:\Production\logs\ppsasset" | Sort-Object LastWriteTime -Descending

# Monitor application pool performance
Get-Counter "\Process(w3wp*)\% Processor Time"
Get-Counter "\Process(w3wp*)\Private Bytes"

# Check website-specific performance
Get-Counter "\Web Service(ppsasset.com)\Current Connections"
```

## Troubleshooting Common Issues

### Port Already in Use
```powershell
# Find what's using standard ports
netstat -ano | findstr :80
netstat -ano | findstr :443

# Check existing website bindings
Get-Website | Format-Table Name, Bindings -AutoSize

# If ports are in use, you may need to:
# 1. Remove conflicting websites
# 2. Change existing site bindings
# 3. Use different ports (not recommended for production)
```

### Application Pool Won't Start
```powershell
# Check Windows Event Log
Get-WinEvent -LogName System | Where-Object {$_.Id -eq 5004} | Select-Object -First 5

# Check .NET installation
dotnet --list-runtimes

# Restart app pool manually
Restart-WebAppPool -Name "ppsasset.com_AppPool"
```

### Database Connection Issues
```bash
# Test database connectivity
mysql -u ppsasset_user -p ppsasset_production_db -e "SELECT 1;"

# Check user permissions
mysql -u root -p -e "SHOW GRANTS FOR 'ppsasset_user'@'localhost';"

# Reset password if needed
mysql -u root -p -e "ALTER USER 'ppsasset_user'@'localhost' IDENTIFIED BY 'newpassword';"
```

### Existing Sites Affected
```powershell
# Emergency rollback
Remove-Website -Name "ppsasset.com" -ErrorAction SilentlyContinue
Remove-WebAppPool -Name "ppsasset.com_AppPool" -ErrorAction SilentlyContinue

# Restore IIS configuration
Restore-WebConfiguration -Name "PPS_Asset_Deployment_[timestamp]"

# Restart existing sites
Get-Website | Where-Object {$_.Name -ne "ppsasset.com"} | Start-Website
```

## Success Criteria

### Deployment Success Indicators
- [ ] Script completes without errors
- [ ] All existing websites still operational  
- [ ] New PPS Asset website responds on standard ports (80/443)
- [ ] Domain ppsasset.com resolves correctly
- [ ] Database connection successful
- [ ] Application pool running with resource limits
- [ ] Log files being created in production directory

### Performance Verification
- [ ] PPS Asset memory usage < 800MB
- [ ] CPU usage < 50% under normal load
- [ ] Response time < 3 seconds
- [ ] No impact on existing site performance

### Security Verification  
- [ ] Database user has minimal required permissions
- [ ] File system permissions properly isolated
- [ ] Security headers configured
- [ ] Request filtering enabled
- [ ] No unauthorized file access possible

## Emergency Contacts & Resources

### Rollback Commands
```powershell
# Complete removal of PPS Asset
Remove-Website -Name "ppsasset.com" -ErrorAction SilentlyContinue
Remove-WebAppPool -Name "ppsasset.com_AppPool" -ErrorAction SilentlyContinue  
Remove-Item "C:\Production\web\ppsasset.com\wwwroot" -Recurse -Force -ErrorAction SilentlyContinue
Remove-Item "C:\Production\logs\ppsasset" -Recurse -Force -ErrorAction SilentlyContinue
```

### Key File Locations
- **Application**: `C:\Production\web\ppsasset.com\wwwroot\`
- **Configuration**: `C:\Production\web\ppsasset.com\wwwroot\appsettings.json`
- **Logs**: `C:\Production\logs\ppsasset\`
- **Database Script**: `C:\Production\web\ppsasset.com\setup_database.sql`
- **IIS Config Backup**: `C:\Backup\IIS_Config_[timestamp]\`

### Access URLs
- **Primary Domain**: `http://ppsasset.com`
- **Secure Domain**: `https://ppsasset.com` (after SSL setup)
- **Direct IP**: `http://103.13.231.222` (may not work with host header binding)
- **Server Management**: RDP to `103.13.231.222:33899`

This production deployment strategy configures PPS Asset as a primary website using standard web ports and the existing directory structure, ensuring professional hosting with proper domain configuration.