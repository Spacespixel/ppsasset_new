@using System.Linq
@using System.Net
@using System.Globalization
@using System.Collections.Generic
@using System.Text.RegularExpressions
@model PPSAsset.Models.ProjectViewModel

@{
    // Helper function to split text into summary and details
    string SplitConceptText(string fullText, out string summary, out string details)
    {
        if (string.IsNullOrEmpty(fullText))
        {
            summary = string.Empty;
            details = string.Empty;
            return string.Empty;
        }

        // Try to split by sentence first (Thai text with punctuation)
        var sentences = Regex.Split(fullText, @"(?<=[\.!?฿])\s+");
        sentences = sentences.Where(s => !string.IsNullOrWhiteSpace(s)).ToArray();

        // If we got sentences from punctuation splitting
        if (sentences.Length > 1)
        {
            int summaryCount = Math.Max(1, sentences.Length / 2);
            summary = string.Join(" ", sentences.Take(summaryCount)).Trim();
            details = string.Join(" ", sentences.Skip(summaryCount)).Trim();
        }
        else
        {
            // Fallback: split by character count (for Thai text without clear punctuation)
            // Split at roughly 50% of text length, trying to find a good breaking point (space or comma)
            int midPoint = fullText.Length / 2;

            // Find the nearest space or comma after midpoint
            int breakPoint = midPoint;
            for (int i = midPoint; i < fullText.Length && i < midPoint + 100; i++)
            {
                if (fullText[i] == ' ' || fullText[i] == ',' || fullText[i] == '、')
                {
                    breakPoint = i;
                    break;
                }
            }

            summary = fullText.Substring(0, breakPoint).Trim();
            details = fullText.Substring(breakPoint).Trim();
        }

        // Ensure we have content in both parts
        if (string.IsNullOrWhiteSpace(details))
        {
            details = string.Empty;
        }

        return fullText;
    }
}

@{
    ViewData["Title"] = $"{Model.Name} - โครงการบ้านเดี่ยวพรีเมียม | PPS Asset";
    var themeClass = ViewBag.ProjectTheme as string ?? "theme-default";
    var primaryColor = ViewBag.ThemePrimaryColor as string ?? "#365523";
    var secondaryColor = ViewBag.ThemeSecondaryColor as string ?? "#4A7030";
    var lightBackground = ViewBag.ThemeLightBackground as string ?? "#F5F7F3";

    string heroImage = Url.Content($"~/images/projects/{Model.Id}/{Model.Images.Hero}");
    string logoImage = Url.Content($"~/images/projects/{Model.Id}/{Model.Images.Logo}");
    string facilityImage = string.IsNullOrWhiteSpace(Model.Images.FacilityMain)
        ? heroImage
        : Url.Content($"~/images/projects/{Model.Id}/{Model.Images.FacilityMain}");
    var registrationModel = ViewBag.RegistrationModel as PPSAsset.Models.RegistrationInputModel ?? new PPSAsset.Models.RegistrationInputModel
    {
        ProjectID = Model.Id,
        ProjectName = string.IsNullOrWhiteSpace(Model.NameTh) ? Model.Name : Model.NameTh
    };
    var provinceOptions = new[] { "กรุงเทพมหานคร", "นนทบุรี", "ปทุมธานี", "สมุทรปราการ" };
    var budgetOptions = new Dictionary<string, string>
    {
        { "8-10", "8-10 ล้านบาท" },
        { "10-12", "10-12 ล้านบาท" },
        { "12-15", "12-15 ล้านบาท" },
        { "15+", "มากกว่า 15 ล้านบาท" }
    };
    var loginReturnUrl = (Context?.Request?.Path + Context?.Request?.QueryString) ?? Url.Action("Project", "Home", new { id = Model.Id });
    var googlePopupUrl = Url.Action("Login", "Account", new { provider = "Google", returnUrl = loginReturnUrl, isPopup = true });
    var facebookPopupUrl = Url.Action("Login", "Account", new { provider = "Facebook", returnUrl = loginReturnUrl, isPopup = true });
    var authProvider = ViewBag.AuthProvider as string;
    var isFacebookAuth = string.Equals(authProvider, "Facebook", System.StringComparison.OrdinalIgnoreCase);
    var isGoogleAuth = string.Equals(authProvider, "Google", System.StringComparison.OrdinalIgnoreCase);
    var providerButtonClass = isFacebookAuth ? "social-btn--facebook" : "social-btn--google";
    var providerDisplayText = isFacebookAuth ? "FACEBOOK" : isGoogleAuth ? "GOOGLE" : authProvider?.ToUpperInvariant();
}

<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="~/css/style-custom.css" asp-append-version="true" />

<!-- Google reCAPTCHA v3 Script -->
<script src="https://www.google.com/recaptcha/api.js?render=@ViewBag.RecaptchaSiteKey"></script>

<div class="project-minisite @themeClass" style="--primary-color: @primaryColor; --secondary-color: @secondaryColor; --light-bg: @lightBackground;">
    <div class="project-mobile-overlay" id="projectMobileOverlay">
        <button class="project-mobile-close" id="projectMobileClose" aria-label="Close menu">
            <span>&times;</span>
        </button>
    </div>

    <header class="project-top-bar">
        <div class="container project-top-bar__inner">
            
            <div class="project-top-bar__inner">
                <img src="@Url.Content("~/images/pps-logo.png")" alt="PPS Asset" />
            </div>
        </div>
    </header>

    <nav class="project-nav" aria-label="Project navigation">
        <div class="container project-nav__inner">
            <a class="project-nav__logo" href="#hero">
                <img src="@logoImage" alt="@Model.Name" />
                
            </a>
            <div class="nav-btn" id="projectHamburger">
                <figure></figure>
                <figure></figure>
                <figure></figure>
            </div>
            <ul class="project-nav__menu" id="projectNavMenu">
                <li><a class="project-nav__link" href="#details">Project Information</a></li>
                 <li><a class="project-nav__link" href="#masterplans">Plan & Layout</a></li>
                <li><a class="project-nav__link" href="#gallery">Gallery</a></li>
                <li><a class="project-nav__link" href="#location">Location</a></li>
                <li><a class="project-nav__link project-nav__cta" href="#register">Register Now</a></li>
            </ul>
        </div>
    </nav>

    <section class="project-hero" id="hero" style="background-image: url('@heroImage');">
        <div class="project-hero__overlay"></div>
        <div class="container">
            <div class="project-hero__content">
                <!-- Title and subtitle removed -->
            </div>
        </div>
    </section>

    <section class="project-section project-register" id="register">
        <div class="container">
            <div class="register-card">
                <div class="register-card__header">
                    <h3>Register Now</h3>
                     <div class="register-social">
                        @if (!(User?.Identity?.IsAuthenticated ?? false))
                        {
                            <button type="button" class="social-btn social-btn--google" data-social-provider="Google" data-social-popup-url="@googlePopupUrl" onclick="openSocialPopup('@googlePopupUrl')">GOOGLE</button>
                            <noscript>
                                <a class="social-btn social-btn--google" asp-controller="Account" asp-action="Login" asp-route-provider="Google" asp-route-returnUrl="@loginReturnUrl">GOOGLE</a>
                            </noscript>
                            <button type="button" class="social-btn social-btn--facebook" data-social-provider="Facebook" data-social-popup-url="@facebookPopupUrl" style="display: none;">FACEBOOK</button>
                            <noscript>
                                <a class="social-btn social-btn--facebook" asp-controller="Account" asp-action="Login" asp-route-provider="Facebook" asp-route-returnUrl="@loginReturnUrl" style="display: none;">FACEBOOK</a>
                            </noscript>
                        }
                        else
                        {
                            <div class="social-authenticated">
                                <span class="social-authenticated__label">เข้าระบบด้วย @providerDisplayText แล้ว</span>
                                <span class="social-authenticated__name">@User?.Identity?.Name</span>
                                <form asp-controller="Account" asp-action="Logout" method="post" class="social-authenticated__logout">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="returnUrl" value="@(Context.Request.Path + Context.Request.QueryString)" />
                                    <button type="submit" class="social-btn @providerButtonClass social-btn--logout">ออกจากระบบ</button>
                                </form>
                            </div>
                        }
                    </div>
                </div>
                @using (Html.BeginForm("RegisterProject", "Home", FormMethod.Post, new { @class = "register-form", id = "registrationForm" }))
                {
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="ProjectID" value="@registrationModel.ProjectID" />
                    <input type="hidden" name="ProjectName" value="@registrationModel.ProjectName" />
                    <input type="hidden" name="ClientFrom" id="registrationClientFrom" value="@registrationModel.ClientFrom" />
                    <input type="hidden" name="UtmSource" value="@registrationModel.UtmSource" />
                    <input type="hidden" name="UtmMedium" value="@registrationModel.UtmMedium" />
                    <input type="hidden" name="UtmCampaign" value="@registrationModel.UtmCampaign" />
                    <input type="hidden" name="UtmTerm" value="@registrationModel.UtmTerm" />
                    <input type="hidden" name="UtmContent" value="@registrationModel.UtmContent" />

                    @if (!ViewData.ModelState.IsValid)
                    {
                        <div class="validation-summary-container alert alert-danger" role="alert">
                            <div class="validation-summary-header">
                                <i class="fa fa-exclamation-triangle"></i>
                                <strong>กรุณาตรวจสอบข้อมูลต่อไปนี้:</strong>
                            </div>
                            <div class="validation-summary-content">
                                @Html.ValidationSummary(false, "", new { @class = "validation-summary-list" })
                            </div>
                        </div>
                    }
                    <fieldset class="form-fieldset">
                        <legend>ข้อมูลการติดต่อ</legend>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="firstName">ชื่อ*</label>
                                <input id="firstName" name="FirstName" type="text" required placeholder="ชื่อ" value="@registrationModel.FirstName" />
                                
                            </div>
                            <div class="form-group">
                                <label for="lastName">นามสกุล*</label>
                                <input id="lastName" name="LastName" type="text" placeholder="นามสกุล" value="@registrationModel.LastName" />
                            </div>
                            <div class="form-group">
                                <label for="email">อีเมล*</label>
                                <input id="email" name="Email" type="email" required placeholder="customer@gmail.com" value="@registrationModel.Email" />
                            </div>
                            <div class="form-group">
                                <label for="phone">หมายเลขโทรศัพท์*</label>
                                <input id="phone" name="TelNo" type="tel" required placeholder="081-234-5678" value="@registrationModel.TelNo" />
                            </div>
                        </div>
                    </fieldset>

                    <fieldset class="form-fieldset">
                        <legend>ที่อยู่ปัจจุบัน</legend>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="province">จังหวัด</label>
                                <select id="province" name="Province" >
                                    <option value="">จังหวัด</option>
                                    @foreach (var province in provinceOptions)
                                    {
                                        if (string.Equals(registrationModel.Province, province, StringComparison.OrdinalIgnoreCase))
                                        {
                                            <option value="@province" selected>@province</option>
                                        }
                                        else
                                        {
                                            <option value="@province">@province</option>
                                        }
                                    }
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="district">เขต / อำเภอ</label>
                                <input id="district" name="District" type="text" placeholder="เขต / อำเภอ" value="@registrationModel.District" />
                            </div>
                        </div>
                    </fieldset>

                    <fieldset class="form-fieldset">
                        <legend>ข้อมูลเพิ่มเติม</legend>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="budget">งบประมาณ</label>
                                <select id="budget" name="Budget">
                                    <option value="">เลือกช่วงงบประมาณ</option>
                                    @foreach (var option in budgetOptions)
                                    {
                                        if (string.Equals(registrationModel.Budget, option.Key, StringComparison.OrdinalIgnoreCase))
                                        {
                                            <option value="@option.Key" selected>@option.Value</option>
                                        }
                                        else
                                        {
                                            <option value="@option.Key">@option.Value</option>
                                        }
                                    }
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="visitDate">วันที่ติดต่อกลับ</label>
                                <input id="visitDate" name="AppointmentDate" type="date" value="@(registrationModel.AppointmentDate?.ToString("yyyy-MM-dd"))" />
                            </div>
                            <div class="form-group">
                                <label for="visitTime">เวลาที่ติดต่อกลับ</label>
                                <input id="visitTime" name="AppointmentTime" type="time" value="@registrationModel.AppointmentTime" />
                            </div>
                            <div class="form-group form-group--full">
                                <label for="notes">ข้อความเพิ่มเติม</label>
                                <textarea id="notes" name="Remark" rows="3" placeholder="แจ้งความต้องการเพิ่มเติม...">@registrationModel.Remark</textarea>
                            </div>
                        </div>
                    </fieldset>

                    <div class="form-extra">
                        <input type="hidden" name="RecaptchaToken" id="recaptchaToken" />
                        <div class="recaptcha-placeholder" id="recaptchaStatus" aria-hidden="true">
                            <span id="recaptchaMessage">Google reCAPTCHA - ตรวจสอบ...</span>
                        </div>
                    </div>

                    <div class="form-footer">
                        <label class="checkbox">
                            <input type="hidden" name="ConsentMarketing" value="false" />
                            <input type="checkbox" name="ConsentMarketing" value="true" @(registrationModel.ConsentMarketing ? "checked" : null) />
                            <span>ยืนยันการยอมรับนโยบายความเป็นส่วนตัว</span>
                        </label>
                        
                        <!-- Minimalist Validation Panel -->
                        <div id="validationPanel" class="validation-panel" style="display: none;">
                            <div class="validation-panel-header">
                                <i class="fa fa-exclamation-circle"></i>
                                <span>ข้อผิดพลาดที่พบ:</span>
                            </div>
                            <ul id="validationErrors" class="validation-errors-list"></ul>
                        </div>
                        
                        <button type="submit" class="btn btn-primary" id="registrationSubmitBtn" disabled>
                            <span class="btn-text">ลงทะเบียน</span>
                            <span class="btn-spinner" style="display: none;">
                                <i class="spinner-icon"></i>
                            </span>
                        </button>
                    </div>
                }
            </div>
        </div>
    </section>

    <!-- Registration Success Modal -->
    <div id="registrationSuccessModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="registrationSuccessModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="success-icon">
                        <i class="icon_check"></i>
                    </div>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body text-center">
                    <h2 class="success-title">ลงทะเบียนสำเร็จ</h2>
                    <div class="success-message">
                        <p>ขอบคุณที่ลงทะเบียนกับ<span id="modalProjectName">โครงการของเรา</span></p>
                        <p>ข้อมูลของคุณได้รับการบันทึกเรียบร้อยแล้ว</p>
                        <p>ทีมงานของเราจะติดต่อกลับในเวลาทำการ 09:00-18:00</p>
                    </div>

                    <div class="success-actions">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">ดูโครงการต่อ</button>
                        <a href="@Url.Action("Index", "Home")" class="btn btn-primary">กลับหน้าหลัก</a>
                    </div>

                    <div class="social-buttons">
                        <a href="https://line.me/ti/p/~@@ppsasset" class="btn-line" target="_blank">
                            <svg width="20" height="20" viewBox="0 0 24 24" style="margin-right: 8px;">
                                <path fill="white" d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63h2.386c.349 0 .63.285.63.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63.349 0 .631.285.631.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12.017.572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/>
                            </svg>
                            สอบถามผ่าน LINE
                        </a>
                        <a href="https://facebook.com/ppsasset" class="btn-facebook" target="_blank" style="display: none;">
                            <i class="social_facebook"></i> แชทผ่าน Facebook
                        </a>
                        <a href="tel:081-933-2888" class="btn-phone">
                            <i class="icon_phone"></i> โทร 081-933-2888
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
   

        <section class="project-section project-details" id="details">
            <div class="container">
                <div class="section-header">
                    <h3 class="section-title">Project Information</h3>
                </div>
            </div>

            <div class="container">
                <div class="project-details__grid">
                    @if (!string.IsNullOrWhiteSpace(Model.Details.ProjectSize))
                    {
                        <div class="detail-card">
                            <div class="detail-icon">
                                <i class="fa fa-map"></i>
                            </div>
                            <div class="detail-content">
                                <div class="detail-label">ขนาดพื้นที่โครงการ</div>
                                <div class="detail-value">@Model.Details.ProjectSize</div>
                            </div>
                        </div>
                    }

                    @if (!string.IsNullOrWhiteSpace(Model.Details.PropertyType))
                    {
                        <div class="detail-card">
                            <div class="detail-icon">
                                <i class="fa fa-home"></i>
                            </div>
                            <div class="detail-content">
                                <div class="detail-label">ลักษณะโครงการ</div>
                                <div class="detail-value">@Model.Details.PropertyType</div>
                            </div>
                        </div>
                    }

                    @if (Model.Details.TotalUnits > 0)
                    {
                        <div class="detail-card">
                            <div class="detail-icon">
                                <i class="fa fa-building"></i>
                            </div>
                            <div class="detail-content">
                                <div class="detail-label">จำนวน</div>
                                <div class="detail-value">@($"{Model.Details.TotalUnits:N0} ยูนิต")</div>
                            </div>
                        </div>
                    }

                    @if (!string.IsNullOrWhiteSpace(Model.Details.LandSize))
                    {
                        <div class="detail-card">
                            <div class="detail-icon">
                                <i class="fa fa-expand"></i>
                            </div>
                            <div class="detail-content">
                                <div class="detail-label">ขนาดพื้นที่ดิน</div>
                                <div class="detail-value">@Model.Details.LandSize</div>
                            </div>
                        </div>
                    }

                    @if (!string.IsNullOrWhiteSpace(Model.Details.UsableArea))
                    {
                        <div class="detail-card">
                            <div class="detail-icon">
                                <i class="fa fa-arrows-alt"></i>
                            </div>
                            <div class="detail-content">
                                <div class="detail-label">ขนาดพื้นที่ใช้สอย</div>
                                <div class="detail-value">@Model.Details.UsableArea</div>
                            </div>
                        </div>
                    }

                    @if (!string.IsNullOrWhiteSpace(Model.Details.PriceRange))
                    {
                        <div class="detail-card">
                            <div class="detail-icon">
                                <i class="fa fa-tag"></i>
                            </div>
                            <div class="detail-content">
                                <div class="detail-label">ราคา</div>
                                <div class="detail-value">@Html.Raw(Model.Details.PriceRange)</div>
                            </div>
                        </div>
                    }

                    @if (Model.Facilities?.Any() == true)
                    {
                        @foreach (var facility in Model.Facilities)
                        {
                            <div class="detail-card">
                                <div class="detail-icon">
                                    <i class="@facility.Icon"></i>
                                </div>
                                <div class="detail-content">
                                    <div class="detail-label">@facility.Name</div>
                                    <div class="detail-value">@facility.Description</div>
                                </div>
                            </div>
                        }
                    }

                    <!-- Terms and Conditions Link -->
                    <div style="grid-column: 1 / -1; text-align: center; margin-top: 20px;">
                        <a href="@(ViewBag.GetProjectUrl != null ? ViewBag.GetProjectUrl(Model.Id) + "/terms-and-conditions" : "/Project/" + Model.Id + "/terms-and-conditions")" 
                           target="_blank" 
                           style="color: #007bff; text-decoration: underline; font-size: 16px;">
                            ดูข้อกำหนดและเงื่อนไข <i class="fa fa-external-link" style="font-size: 12px; margin-left: 5px;"></i>
                        </a>
                    </div>
                </div>
            </div>
        </section>

    <section class="project-section project-pillars" id="concept">
        <div class="concept-section">
            <div class="container">
                <!-- Simple horizontal concept blocks like the reference image -->
                <div class="concept-blocks">
                    @{
                        // Get gallery images for concept section
                        var availableImages = new List<string>();
                        if (Model.Images?.Gallery != null)
                        {
                            availableImages.AddRange(Model.Images.Gallery.Take(2));
                        }

                        // Ensure we have at least 2 images
                        if (availableImages.Count == 1)
                        {
                            availableImages.Add(availableImages[0]);
                        }
                        else if (availableImages.Count == 0)
                        {
                            availableImages.Add("placeholder-concept.jpg");
                            availableImages.Add("placeholder-concept.jpg");
                        }
                    }

                    @{
                        // Parse ProjectConcept HTML from database
                        string title = string.Empty;
                        string summary = string.Empty;
                        string details = string.Empty;

                        if (!string.IsNullOrEmpty(Model.Concept))
                        {
                            var conceptText = Model.Concept;

                            // Extract h3 or h4 title
                            var titleMatch = Regex.Match(conceptText, @"<h[34]>(.*?)</h[34]>", RegexOptions.IgnoreCase | RegexOptions.Singleline);
                            if (titleMatch.Success)
                            {
                                title = titleMatch.Groups[1].Value;
                                conceptText = Regex.Replace(conceptText, @"<h[34]>.*?</h[34]>", "", RegexOptions.IgnoreCase | RegexOptions.Singleline);
                            }

                            // Extract paragraphs
                            var paragraphs = Regex.Matches(conceptText, @"<p[^>]*>(.*?)</p>", RegexOptions.IgnoreCase | RegexOptions.Singleline);
                            if (paragraphs.Count >= 2)
                            {
                                summary = paragraphs[0].Groups[1].Value.Trim();
                                details = paragraphs[1].Groups[1].Value.Trim();
                            }
                            else if (paragraphs.Count == 1)
                            {
                                summary = paragraphs[0].Groups[1].Value.Trim();
                            }

                            if (string.IsNullOrEmpty(title))
                            {
                                title = Model.Name;
                            }
                        }
                    }

                    @if (!string.IsNullOrEmpty(title))
                    {
                        <!-- Single Row: Image on left, Title + Summary + Details on right -->
                        <div class="concept-row">
                            <div class="concept-image-section">
                                @if (availableImages.Count > 0)
                                {
                                    <img src="@Url.Content($"~/images/projects/{Model.Id}/galleries/{availableImages[0]}")" alt="@Model.Name" />
                                }
                            </div>
                            <div class="concept-text-section">
                                <h3>@Html.Raw(title)</h3>
                                @if (!string.IsNullOrEmpty(summary))
                                {
                                    <p>@Html.Raw(summary)</p>
                                }
                                @if (!string.IsNullOrEmpty(details))
                                {
                                    <p>@Html.Raw(details)</p>
                                }
                            </div>
                        </div>
                    }
            </div>
            </div>
        </div>
    </section>

    <style>
        /* Override all concept styling with simple clean design */
        .concept-section {
            background: var(--light-bg) !important;
            padding: 80px 0 !important;      /* Increased vertical padding */
            margin: 0 !important;
            opacity: 0;
            transform: translateY(50px);
            transition: all 1.2s ease-out;
        }

        .concept-section.animate-in {
            opacity: 1;
            transform: translateY(0);
        }

        .concept-blocks {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .concept-row {
            display: flex;
            align-items: stretch;
            min-height: 420px;
            opacity: 0;
            transform: translateY(50px);
            transition: all 0.8s ease-out;
        }

        .concept-section.animate-in .concept-row {
            opacity: 1;
            transform: translateY(0);
        }

        .concept-row:last-child {
            margin-bottom: 0;
        }

        /* Keep all items in same direction - no alternating */
        .concept-row:nth-child(even),
        .concept-row-reverse {
            flex-direction: row;            /* Keep same direction, no reverse */
        }

        .concept-text-section {
            flex: 1;
            padding: 60px 70px;         /* Restored padding for single image layout */
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: transparent;
        }

        .concept-image-section {
            flex: 1;
            overflow: hidden;
        }

        .concept-image-section img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .concept-text-section h3 {
            /* Font family inherited from typography.css */
            font-size: 3.5rem;      /* 56px - matches .section-title in project details */
            font-weight: 700;
            color: #2d3436;
            margin: 0 0 40px 0;     /* Increased spacing after title */
            line-height: 1.2;
        }

        .concept-subtitle {
            /* Subtitle under project name */
            font-size: 1.25rem;     /* 20px */
            color: var(--primary-color);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin: 0 0 20px 0;     /* Space before intro text */
        }

        .concept-intro {
            /* Summary/intro text in Block 1 */
            font-size: 1.25rem;     /* 20px - slightly smaller than details for hierarchy */
            color: #636e72;
            line-height: 1.6;
            margin: 0;
            font-weight: 500;
            padding-top: 15px;      /* Space between subtitle and intro */
            border-top: 2px solid var(--primary-color);
            border-top-opacity: 0.2;
        }

        .concept-text-section p {
            /* Font family inherited from typography.css */
            font-size: 1.5rem;      /* 24px - matches project details card size */
            color: #636e72;
            line-height: 1.7;
            margin: 0;
            font-weight: 500;       /* Slightly bolder for better readability */
        }

        .concept-text-section p:first-of-type {
            /* First paragraph (details in Block 2) */
            margin-top: 0;
        }

        /* Hide old card elements */
        .concept-cards-grid,
        .concept-card,
        .concept-header,
        .concept-main-title,
        .concept-subtitle {
            display: none !important;
        }

        /* Responsive Design */
        @@media (max-width: 768px) {
            .concept-section {
                padding: 60px 0 !important;     /* Reduced from 80px on mobile */
            }

            .concept-row {
                flex-direction: column;
                min-height: auto;
                margin-bottom: 50px;            /* Add spacing between concept items on mobile */
            }

            .concept-text-section {
                padding: 50px 40px;             /* Increased from 40px 30px */
            }

            .concept-image-section {
                height: 300px;                  /* Increased from 250px */
            }

            .concept-text-section h3 {
                font-size: 1.625rem;    /* 26px - tablet h3 */
                margin: 0 0 25px 0;     /* Adjust spacing for smaller screens */
            }

            .concept-subtitle {
                font-size: 1.0625rem;   /* 17px - scaled for tablet */
                margin: 0 0 15px 0;
            }

            .concept-intro {
                font-size: 1.0625rem;   /* 17px - tablet intro */
                padding-top: 12px;
                border-top-width: 1px;
            }

            .concept-text-section p {
                font-size: 1.25rem;     /* 20px - tablet body, scaled down from 24px */
            }
        }

        @@media (max-width: 480px) {
            .concept-section {
                padding: 50px 0 !important;     /* Further reduced on mobile */
            }

            .concept-row {
                margin-bottom: 40px;            /* Reduced further on mobile */
            }

            .concept-text-section {
                padding: 40px 25px;             /* Reduced for mobile screen */
            }

            .concept-text-section h3 {
                font-size: 1.375rem;    /* 22px - mobile h3 */
                margin: 0 0 20px 0;     /* Reduced title spacing on mobile */
            }

            .concept-subtitle {
                font-size: 1rem;        /* 16px - mobile subtitle */
                margin: 0 0 12px 0;
            }

            .concept-intro {
                font-size: 1rem;        /* 16px - mobile intro */
                padding-top: 10px;
                border-top-width: 1px;
                line-height: 1.5;
            }

            .concept-text-section p {
                font-size: 1rem;        /* 16px - mobile body, scaled down from 24px */
            }

            .concept-image-section {
                height: 220px;                  /* Reduced on mobile */
            }
        }

        /* House Description Styles */
        .house-description {
            font-size: 1rem;
            color: #666;
            margin: 8px 0 0 0;
            line-height: 1.4;
            font-weight: 400;
        }

        @@media (max-width: 768px) {
            .house-description {
                font-size: 1rem;
            }
        }

        /* Authentication Loading Styles */
        .auth-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 15px;
            background: rgba(54, 85, 35, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(54, 85, 35, 0.1);
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(54, 85, 35, 0.2);
            border-left: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @@keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .auth-loading span {
            color: var(--primary-color);
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Minimalist Validation Panel */
        .validation-panel {
            background: #fff5f5;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .validation-panel-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            color: #e53e3e;
            font-weight: 500;
            font-size: 1rem;
        }

        .validation-panel-header i {
            font-size: 1.1rem;
        }

        .validation-errors-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .validation-errors-list li {
            background: #ffffff;
            border-radius: 4px;
            padding: 8px 12px;
            margin-bottom: 6px;
            color: #c53030;
            font-size: 1rem;
            line-height: 1.4;
            position: relative;
        }

        .validation-errors-list li:before {
            content: '•';
            color: #e53e3e;
            font-weight: bold;
            margin-right: 8px;
        }

        .validation-errors-list li:last-child {
            margin-bottom: 0;
        }
    </style>

    <script>
        // Function to show validation errors in minimalist panel
        function showValidationErrors(errors) {
            const validationPanel = document.getElementById('validationPanel');
            const validationErrors = document.getElementById('validationErrors');
            
            if (validationPanel && validationErrors && errors && errors.length > 0) {
                // Clear previous errors
                validationErrors.innerHTML = '';
                
                // Add each error as a list item
                errors.forEach(error => {
                    if (error) {
                        const li = document.createElement('li');
                        li.textContent = error;
                        validationErrors.appendChild(li);
                    }
                });
                
                // Show the panel
                validationPanel.style.display = 'block';
                
                // Scroll to the validation panel
                validationPanel.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        // Function to hide validation panel
        function hideValidationErrors() {
            const validationPanel = document.getElementById('validationPanel');
            if (validationPanel) {
                validationPanel.style.display = 'none';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const conceptSection = document.querySelector('.concept-section');
            const locationGrid = document.querySelector('.location-grid');

            if (conceptSection) {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('animate-in');
                            observer.unobserve(entry.target);
                        }
                    });
                }, {
                    threshold: 0.2,
                    rootMargin: '0px 0px -10% 0px'
                });

                observer.observe(conceptSection);
            }

            // Animation for location cards
            if (locationGrid) {
                const locationObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('animate-in');
                            locationObserver.unobserve(entry.target);
                        }
                    });
                }, {
                    threshold: 0.1,
                    rootMargin: '0px 0px -5% 0px'
                });

                locationObserver.observe(locationGrid);
            }
        });
    </script>




    @if (Model.HouseTypes?.Any() == true)
    {
        <section class="project-section project-plans" id="masterplans">
            <div class="container">
                <div class="section-header">
                    <h3 class="section-title">Plan & Layout</h3>
                </div>

                <!-- Filter Buttons -->
                <div class="house-type-filters">
                    <div class="filter-buttons">
                         @{
                            var houseTypeIndex = 0;
                         }
                        @foreach (var house in Model.HouseTypes)
                        {
                            @if (houseTypeIndex==0)
                            {
                            <button class="filter-btn active" data-filter="@house.Id">
                                <i class="fa fa-home"></i>
                                <span>@house.DisplayName</span>
                            </button>
                            }
                            else
                            {
                            <button class="filter-btn" data-filter="@house.Id">
                                <i class="fa fa-home"></i>
                                <span>@house.DisplayName</span>
                            </button>
                            }
                            houseTypeIndex++;
                        }
                    </div>
                </div>

                <!-- House Type Display Area -->
                <div class="house-type-display">
                    @foreach (var house in Model.HouseTypes)
                    {
                        var facadeImage = house.Images.FirstOrDefault();
                        <div class="house-type-item" data-type="@house.Id">
                            <div class="house-type-card-inline">
                                @{
                                    var defaultFloorPlan = house.FloorPlans.FirstOrDefault(fp => fp.Type == FloorType.Facade)
                                                          ?? house.FloorPlans.FirstOrDefault(fp => fp.Type == FloorType.GroundFloor)
                                                          ?? house.FloorPlans.FirstOrDefault(fp => fp.Type == FloorType.SecondFloor)
                                                          ?? house.FloorPlans.FirstOrDefault();

                                    var defaultImagePath = defaultFloorPlan?.ImagePath ?? "Home_S_Perspective_Final_1.jpg";
                                }

                                <!-- Main Content Layout: Image Left, Info Right -->
                                <div class="house-main-content">
                                    <!-- Floor Plan Image Section (LEFT) -->
                                    <div class="house-floorplan-section">
                                        <div class="main-floorplan-container">
                                            <img src="@Url.Content($"~/images/projects/{Model.Id}/masterplan/{defaultImagePath}")"
                                                 alt="@house.DisplayName Floor Plan"
                                                 class="main-floorplan-image"
                                                 id="mainFloorPlan-@house.Id" />
                                        </div>

                                        <!-- Floor Plan Thumbnails -->
                                        <div class="floorplan-thumbnails">
                                            @{
                                                var floorPlanThumbnails = new List<FloorPlan>();

                                                if (house.FloorPlans.Any())
                                                {
                                                    // Add floor plans in order: Facade, Ground Floor, Second Floor
                                                    var facade = house.FloorPlans.FirstOrDefault(fp => fp.Type == FloorType.Facade);
                                                    var ground = house.FloorPlans.FirstOrDefault(fp => fp.Type == FloorType.GroundFloor);
                                                    var second = house.FloorPlans.FirstOrDefault(fp => fp.Type == FloorType.SecondFloor);

                                                    if (facade != null) floorPlanThumbnails.Add(facade);
                                                    if (ground != null) floorPlanThumbnails.Add(ground);
                                                    if (second != null) floorPlanThumbnails.Add(second);
                                                }

                                                // If no floor plans, create fallback ones
                                                if (!floorPlanThumbnails.Any())
                                                {
                                                    floorPlanThumbnails.AddRange(new[]
                                                    {
                                                        new FloorPlan { Name = "Facade", ImagePath = "Home_S_Perspective_Final_1.jpg", Type = FloorType.Facade },
                                                        new FloorPlan { Name = "1st Floor", ImagePath = "Home_S_Perspective_Final_1.jpg", Type = FloorType.GroundFloor },
                                                        new FloorPlan { Name = "2nd Floor", ImagePath = "Home_S_Perspective_Final_1.jpg", Type = FloorType.SecondFloor }
                                                    });
                                                }
                                            }

                                            @for (int i = 0; i < floorPlanThumbnails.Count; i++)
                                            {
                                                var floorPlan = floorPlanThumbnails[i];
                                                var isActive = floorPlan.Type == FloorType.Facade ? "active" : "";

                                                <div class="floorplan-thumb @isActive" onclick="changeFloorPlan('@house.Id', '@Url.Content($"~/images/projects/{Model.Id}/masterplan/{floorPlan.ImagePath}")', '@floorPlan.Name')">
                                                    <img src="@Url.Content($"~/images/projects/{Model.Id}/masterplan/{floorPlan.ImagePath}")" alt="@floorPlan.Name" />
                                                    <span class="thumb-label">@floorPlan.Name</span>
                                                </div>
                                            }
                                        </div>
                                    </div>

                                    <!-- House Information Section (RIGHT) -->
                                    <div class="house-info-section">
                                        <!-- Header -->
                                        <div class="house-header">
                                            <h4 class="house-title">@house.DisplayName</h4>
                                            @if (!string.IsNullOrEmpty(house.Description))
                                            {
                                                <p class="house-description">@house.Description</p>
                                            }
                                        </div>

                                        <!-- Specifications Grid -->
                                        <div class="house-specs">
                                            <div class="spec-row">
                                                <div class="spec-icon">
                                                    <i class="fa fa-arrows-alt"></i>
                                                </div>
                                                <div class="spec-details">
                                                    <div class="spec-number">@house.UsableArea</div>
                                                 </div>
                                             </div>
                                               <div class="spec-row">
                                                <div class="spec-icon">
                                                    <i class="fa fa-square-o"></i>
                                                </div>
                                                <div class="spec-details">
                                                    <div class="spec-number">@house.LandSize </div>
                                                 </div>
                                            </div>
                                            <div class="spec-row">
                                                <div class="spec-icon">
                                                    <i class="fa fa-bed"></i>
                                                </div>
                                                <div class="spec-details">
                                                    <div class="spec-number">@house.Bedrooms</div>
                                                    <div class="spec-unit">ห้อง</div>
                                                </div>
                                            </div>

                                            <div class="spec-row">
                                                <div class="spec-icon">
                                                    <i class="fa fa-bath"></i>
                                                </div>
                                                <div class="spec-details">
                                                    <div class="spec-number">@house.Bathrooms</div>
                                                    <div class="spec-unit">ห้อง</div>
                                                </div>
                                            </div>

                                            <div class="spec-row">
                                                <div class="spec-icon">
                                                    <i class="fa fa-car"></i>
                                                </div>
                                                <div class="spec-details">
                                                    <div class="spec-number">@house.Parking</div>
                                                    <div class="spec-unit">คัน</div>
                                                </div>
                                            </div>
                                            
                                        </div>

                                        

                                        <!-- Price -->
                                        @if (!string.IsNullOrWhiteSpace(house.PriceRange))
                                        {
                                            <div class="house-price">
                                                <span class="price-label">ราคาเริ่มต้น</span>
                                                <span class="price-value">@Html.Raw(house.PriceRange)</span>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </section>
    }

  

    @if (Model.Images?.Gallery?.Any() == true)
    {
        <section class="project-section project-gallery" id="gallery">
            <div class="container">
                <div class="section-header">
                     <h3 class="section-title">Gallery</h3>
                </div>

                <!-- Gallery Filters -->
                <div class="gallery-filters">
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-filter="all">
                            <i class="fa fa-image"></i>
                            <span>ทั้งหมด</span>
                        </button>
                        <button class="filter-btn" data-filter="facility">
                            <i class="fa fa-building"></i>
                            <span>ส่วนกลาง</span>
                        </button>
                         @if (Model.HouseTypes?.Any() == true)
                        {
                            @foreach (var house in Model.HouseTypes)
                            {
                                <button class="filter-btn" data-filter="@house.Id">
                                <i class="fa fa-home"></i>
                                <span>@house.DisplayName</span>
                               </button>
                            }
                        }    
                    </div>
                </div>

                <!-- Gallery Grid -->
                <div class="gallery-grid">
                    @foreach (var image in Model.Images.Gallery)
                    {
                        <a href="@Url.Content($"~/images/projects/{Model.Id}/galleries/{image}")"
                           class="gallery-card"
                           data-gallery="project-gallery"
                           data-image-name="@image">
                            <img src="@Url.Content($"~/images/projects/{Model.Id}/galleries/{image}")"
                                 alt="@Model.Name"
                                 loading="lazy" />
                            <div class="gallery-overlay">
                                <i class="fa fa-expand"></i>
                            </div>
                        </a>
                    }
                </div>
            </div>
        </section>
    }

    <!-- Image Gallery Modal -->
    <div id="galleryModal" class="gallery-modal">
        <div class="gallery-modal-content">
            <button class="gallery-modal-close" aria-label="Close">&times;</button>
            <button class="gallery-modal-prev" aria-label="Previous image">&#8249;</button>
            <button class="gallery-modal-next" aria-label="Next image">&#8250;</button>
            <img id="galleryModalImage" src="" alt="" class="gallery-modal-image">
            <div class="gallery-modal-counter">
                <span id="galleryModalCurrent">1</span> / <span id="galleryModalTotal">1</span>
            </div>
        </div>
    </div>

    @if (Model.Location != null)
    {
        <section class="project-section project-location" id="location">
            <div class="container">
                <div class="section-header">

                    <h3 class="section-title">Location</h3>
                    @if (!string.IsNullOrWhiteSpace(Model.Details.Location))
                    {
                        <p class="project-location__address">ที่ตั้งโครงการ : @Model.Details.Location</p>
                    }
                </div>

                <!-- Map Type Filters -->
                <div class="location-filters">
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-filter="google-map">
                            <i class="fa fa-map"></i>
                            <span>Google Map</span>
                        </button>
                        <button class="filter-btn" data-filter="graphic-map">
                            <i class="fa fa-image"></i>
                            <span>Graphic Map</span>
                        </button>
                    </div>
                </div>

                @{
                    decimal latValue = Model.Location.Latitude;
                    decimal lonValue = Model.Location.Longitude;
                    bool hasCoordinates = latValue != 0m || lonValue != 0m;
                    string mapSrc = string.Empty;

                    if (hasCoordinates)
                    {
                        var lat = latValue.ToString(CultureInfo.InvariantCulture);
                        var lon = lonValue.ToString(CultureInfo.InvariantCulture);
                        mapSrc = $"https://www.google.com/maps?q={lat},{lon}&z=15&output=embed";
                    }
                    else if (!string.IsNullOrWhiteSpace(Model.Location.Address))
                    {
                        mapSrc = $"https://www.google.com/maps?q={WebUtility.UrlEncode(Model.Location.Address)}&z=15&output=embed";
                    }
                    else
                    {
                        // Fallback with project location from Details
                        var fallbackLocation = !string.IsNullOrWhiteSpace(Model.Details.Location)
                            ? WebUtility.UrlEncode(Model.Details.Location)
                            : WebUtility.UrlEncode("Bangkok, Thailand");
                        mapSrc = $"https://www.google.com/maps?q={fallbackLocation}&z=12&output=embed";
                    }
                }

                <!-- Google Maps Container -->
                <div class="map-container" id="google-map-container">
                    <div class="location-map">
                        @if (!string.IsNullOrWhiteSpace(mapSrc))
                        {
                            <iframe loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade" src="@mapSrc"></iframe>
                        }
                    </div>
                </div>

                <!-- Graphic Map Container -->
                <div class="map-container" id="graphic-map-container" style="display: none;">
                    <div class="location-map">
                        <img src="@Url.Content($"~/images/projects/{Model.Id}/{Model.Images?.LocationMap ?? "map-placeholder.jpg"}")" alt="แผนที่โครงการ" />
                    </div>
                </div>

                <!-- Nearby Places Info (shown for both map types) -->
                <div class="project-location__info">
                    @if (Model.Location.NearbyPlaces?.Any() == true)
                    {
                        var groupedPlaces = Model.Location.NearbyPlaces
                            .GroupBy(p => string.IsNullOrWhiteSpace(p.Category) ? "สถานที่ใกล้เคียง" : p.Category);

                        <div class="location-grid">
                            @foreach (var group in groupedPlaces)
                            {
                                <div class="location-column">
                                    <div class="location-category">
                                        <div class="category-icon">
                                            @{
                                                var categoryName = group.Key.ToLower();
                                                string iconClass = GetCategoryIcon(categoryName);
                                            }
                                            <i class="@iconClass"></i>
                                        </div>
                                        <h4>@group.Key</h4>
                                    </div>
                                    <ul class="location-list">
                                        @foreach (var place in group)
                                        {
                                            <li>
                                                <span class="place-name">@place.Name</span>
                                                <span class="place-distance">@place.Distance</span>
                                            </li>
                                        }
                                    </ul>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        </section>
    }





</div>

@functions {
    private string GetCategoryIcon(string category)
    {
        return category switch
        {
            // Transportation
            _ when category.Contains("การเดินทาง") || category.Contains("transport") || category.Contains("รถไฟฟ้า") || category.Contains("MRT") || category.Contains("BTS") =>
                "fa fa-subway",

            // Shopping malls
            _ when category.Contains("ห้างสรรพสินค้า") || category.Contains("shopping") || category.Contains("mall") || category.Contains("ห้างสรรพ") =>
                "fa fa-shopping-bag",

            // Hospital/Medical
            _ when category.Contains("โรงพยาบาล") || category.Contains("hospital") || category.Contains("medical") || category.Contains("สถานพยาบาล") || category.Contains("รพ") =>
                "fa fa-hospital-o",

            // Community & Lifestyle
            _ when category.Contains("คอมมูนิตี้") || category.Contains("ไลฟ์สไตล์") || category.Contains("community") || category.Contains("lifestyle") || category.Contains("คอมมูนิตี") =>
                "fa fa-users",

            // Education/School
            _ when category.Contains("สถานศึกษา") || category.Contains("school") || category.Contains("education") || category.Contains("โรงเรียน") || category.Contains("มหาวิทยาลัย") =>
                "fa fa-graduation-cap",

            // Park/Recreation
            _ when category.Contains("สวน") || category.Contains("park") || category.Contains("tree") || category.Contains("สวนสาธารณะ") =>
                "fa fa-tree",

            // Default
            _ => "fa fa-map-marker"
        };
    }
}

@section Scripts {
    <script>
        function openSocialPopup(url) {
            console.log('Opening popup with URL:', url);
            
            // Calculate popup position to center it
            const left = (screen.width / 2) - (600 / 2);
            const top = (screen.height / 2) - (700 / 2);
            
            const popup = window.open(
                url,
                'SocialLoginPopup',
                `width=600,height=700,left=${left},top=${top},menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes`
            );

            if (!popup || popup.closed) {
                console.warn('Popup was blocked or failed to open, redirecting to URL');
                window.location.href = url;
                return false;
            }
            
            popup.focus();
            
            // Monitor popup for manual close (fallback)
            const checkClosed = setInterval(() => {
                if (popup.closed) {
                    clearInterval(checkClosed);
                    console.log('Popup was closed manually, checking if login was successful');
                    
                    // Small delay to allow server processing, then update UI without reload
                    setTimeout(() => {
                        // Simple: just navigate to register section
                        window.location.hash = '#register';
                    }, 1000);
                }
            }, 500);
            
            return false; // Prevent default
        }

        window.handleSocialLoginSuccess = function (provider, targetUrl) {
            // Simple: just reload the page to show authenticated state
            location.reload();
        };

        document.addEventListener('DOMContentLoaded', function () {

            if (window.location.hash === '#register') {
                const registerSection = document.getElementById('register');
                registerSection?.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

            const hamburger = document.getElementById('projectHamburger');
            const navMenu = document.getElementById('projectNavMenu');
            const overlay = document.getElementById('projectMobileOverlay');
            const body = document.body;

            function closeMenu() {
                navMenu?.classList.remove('is-open');
                hamburger?.classList.remove('is-active');
                overlay?.classList.remove('is-active');
                hamburger?.setAttribute('aria-expanded', 'false');
                body.classList.remove('nav-open');
            }

            function toggleMenu() {
                const willOpen = !navMenu?.classList.contains('is-open');
                navMenu?.classList.toggle('is-open');
                hamburger?.classList.toggle('is-active');
                overlay?.classList.toggle('is-active');
                hamburger?.setAttribute('aria-expanded', willOpen ? 'true' : 'false');
                body.classList.toggle('nav-open', willOpen);
            }

            hamburger?.addEventListener('click', toggleMenu);
            overlay?.addEventListener('click', closeMenu);
            
            // Close button functionality
            const closeButton = document.getElementById('projectMobileClose');
            closeButton?.addEventListener('click', closeMenu);

            navMenu?.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', function(e) {
                    const href = this.getAttribute('href');
                    
                    if (href && href.startsWith('#')) {
                        e.preventDefault();
                        
                        const targetId = href.substring(1);
                        const targetElement = document.getElementById(targetId);
                        
                        if (targetElement) {
                            // Check if mobile menu is open
                            const isMobileMenuOpen = navMenu?.classList.contains('is-open');
                            
                            // Close menu first
                            closeMenu();
                            
                            // Wait longer for mobile menu close animation
                            const delay = isMobileMenuOpen ? 600 : 300;
                            setTimeout(() => {
                                // Get current nav height more accurately
                                const nav = document.querySelector('.project-nav');
                                const navHeight = nav ? nav.getBoundingClientRect().height : 80;
                                
                                // Get the element's position relative to the document
                                const rect = targetElement.getBoundingClientRect();
                                const targetPosition = rect.top + window.pageYOffset - navHeight - 20;
                                
                                // Try scrollTo first
                                window.scrollTo({
                                    top: Math.max(0, targetPosition), // Ensure we don't scroll past top
                                    behavior: 'smooth'
                                });
                                
                                // Fallback for mobile devices that might have issues with scrollTo
                                if (isMobileMenuOpen) {
                                    setTimeout(() => {
                                        targetElement.scrollIntoView({ 
                                            behavior: 'smooth', 
                                            block: 'start' 
                                        });
                                        // Adjust for navbar
                                        setTimeout(() => {
                                            const adjustedPosition = window.scrollY - navHeight - 20;
                                            if (adjustedPosition >= 0) {
                                                window.scrollTo({
                                                    top: adjustedPosition,
                                                    behavior: 'auto' // Use auto for final adjustment on mobile
                                                });
                                            }
                                        }, 200);
                                    }, 100);
                                }
                            }, delay);
                        }
                    } else {
                        closeMenu();
                    }
                });
            });

            // House Type Filter functionality
            const filterButtons = document.querySelectorAll('.house-type-filters .filter-btn');
            const houseItems = document.querySelectorAll('.house-type-item');

            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    // Add active class to clicked button
                    this.classList.add('active');

                    const filterValue = this.getAttribute('data-filter');

                    houseItems.forEach(item => {
                        if (filterValue === 'all' || item.getAttribute('data-type') === filterValue) {
                            item.style.display = 'block';
                            // Add fade in animation
                            item.style.opacity = '0';
                            setTimeout(() => {
                                item.style.opacity = '1';
                            }, 50);
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            });

            // Initialize - show first house type by default
            if (houseItems.length > 0) {
                houseItems.forEach((item, index) => {
                    item.style.display = index === 0 ? 'block' : 'none';
                });
            }
        });

        // Function to change main image when thumbnail is clicked
        function changeMainImage(thumbnail) {
            const container = thumbnail.closest('.house-image-container');
            const mainImage = container.querySelector('.house-main-image');
            const thumbnails = container.querySelectorAll('.thumbnail');

            // Update main image source
            mainImage.src = thumbnail.src;

            // Update active thumbnail
            thumbnails.forEach(thumb => thumb.classList.remove('active'));
            thumbnail.classList.add('active');
        }

        // Floor plan modal functions
        function openFloorPlanModal(triggerElement) {
            const houseTypeItem = triggerElement.closest('.house-type-item');
            const modal = houseTypeItem.querySelector('.floor-plan-modal');
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeFloorPlanModal(closeButton) {
            const modal = closeButton.closest('.floor-plan-modal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        function changeFloorPlan(houseId, imageSrc, floorName) {
            // Update main floor plan image
            const mainFloorPlan = document.getElementById(`mainFloorPlan-${houseId}`);
            if (mainFloorPlan) {
                mainFloorPlan.src = imageSrc;
            }

            // Update floor indicator
            const currentFloor = document.getElementById(`currentFloor-${houseId}`);
            if (currentFloor) {
                currentFloor.textContent = floorName.toUpperCase();
            }

            // Update active thumbnail
            const houseCard = mainFloorPlan.closest('.house-type-card-inline');
            const thumbnails = houseCard.querySelectorAll('.floorplan-thumb');
            thumbnails.forEach(thumb => {
                thumb.classList.remove('active');
            });

            // Add active class to clicked thumbnail
            const clickedThumbnail = event.target.closest('.floorplan-thumb');
            if (clickedThumbnail) {
                clickedThumbnail.classList.add('active');
            }
        }

        // Function to set up dynamic animation delays
        function setupGalleryAnimations() {
            const visibleCards = document.querySelectorAll('.gallery-card:not(.gallery-hidden)');
            visibleCards.forEach((card, index) => {
                const delay = 0.1 + (index * 0.05); // Start at 0.1s, add 0.05s for each item
                card.style.animationDelay = delay + 's';
                // Remove and re-add the animation class to restart it
                card.classList.remove('animate');
                setTimeout(() => {
                    card.classList.add('animate');
                }, 10);
            });
        }

        // Function to observe when gallery section comes into view
        function setupGalleryScrollAnimation() {
            const gallerySection = document.querySelector('#gallery');
            let hasAnimated = false;

            if (!gallerySection) return;

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && !hasAnimated) {
                        hasAnimated = true;
                        setupGalleryAnimations();
                        observer.unobserve(gallerySection); // Only animate once
                    }
                });
            }, {
                threshold: 0.2, // Trigger when 20% of gallery is visible
                rootMargin: '0px 0px -50px 0px' // Slightly before it fully comes into view
            });

            observer.observe(gallerySection);

            // Fallback: If gallery is already visible on page load, animate immediately
            setTimeout(() => {
                if (!hasAnimated) {
                    const rect = gallerySection.getBoundingClientRect();
                    if (rect.top < window.innerHeight && rect.bottom > 0) {
                        hasAnimated = true;
                        setupGalleryAnimations();
                        observer.unobserve(gallerySection);
                    }
                }
            }, 100);
        }

        // Gallery Modal Functions
        let currentImageIndex = 0;
        let galleryImages = [];

        function initializeModal() {
            const modal = document.getElementById('galleryModal');
            const modalImage = document.getElementById('galleryModalImage');
            const closeBtn = document.querySelector('.gallery-modal-close');
            const prevBtn = document.querySelector('.gallery-modal-prev');
            const nextBtn = document.querySelector('.gallery-modal-next');
            const currentSpan = document.getElementById('galleryModalCurrent');
            const totalSpan = document.getElementById('galleryModalTotal');

            // Collect all visible gallery images
            function updateGalleryImages() {
                const visibleGalleryCards = document.querySelectorAll('.gallery-card:not(.gallery-hidden)');
                galleryImages = Array.from(visibleGalleryCards).map(card => ({
                    src: card.href,
                    alt: card.querySelector('img').alt
                }));
                totalSpan.textContent = galleryImages.length;
            }

            // Open modal
            function openModal(imageSrc) {
                updateGalleryImages();
                currentImageIndex = galleryImages.findIndex(img => img.src === imageSrc);
                if (currentImageIndex === -1) currentImageIndex = 0;

                showImage();
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
            }

            // Close modal
            function closeModal() {
                modal.classList.remove('show');
                document.body.style.overflow = '';
            }

            // Show current image
            function showImage() {
                if (galleryImages.length > 0) {
                    const currentImage = galleryImages[currentImageIndex];
                    modalImage.src = currentImage.src;
                    modalImage.alt = currentImage.alt;
                    currentSpan.textContent = currentImageIndex + 1;
                }
            }

            // Navigation functions
            function nextImage() {
                currentImageIndex = (currentImageIndex + 1) % galleryImages.length;
                showImage();
            }

            function prevImage() {
                currentImageIndex = (currentImageIndex - 1 + galleryImages.length) % galleryImages.length;
                showImage();
            }

            // Event listeners
            closeBtn.addEventListener('click', closeModal);
            prevBtn.addEventListener('click', prevImage);
            nextBtn.addEventListener('click', nextImage);

            // Click outside modal to close
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModal();
                }
            });

            // Keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (!modal.classList.contains('show')) return;

                switch(e.key) {
                    case 'Escape':
                        closeModal();
                        break;
                    case 'ArrowLeft':
                        prevImage();
                        break;
                    case 'ArrowRight':
                        nextImage();
                        break;
                }
            });

            // Add click listeners to gallery images
            document.addEventListener('click', function(e) {
                const galleryCard = e.target.closest('.gallery-card');
                if (galleryCard && !galleryCard.classList.contains('gallery-hidden')) {
                    e.preventDefault();
                    openModal(galleryCard.href);
                }
            });
        }

        // Initialize first thumbnail as active
        document.addEventListener('DOMContentLoaded', function() {
            // Set up scroll-triggered gallery animations
            setupGalleryScrollAnimation();

            // Initialize gallery modal
            initializeModal();

            const firstThumbnails = document.querySelectorAll('.house-image-thumbnails .thumbnail:first-child');
            firstThumbnails.forEach(thumb => thumb.classList.add('active'));

            const socialButtons = document.querySelectorAll('.register-social .social-btn');
            const clientSourceInput = document.getElementById('registrationClientFrom');
            socialButtons.forEach(button => {
                button.addEventListener('click', function () {
                    if (clientSourceInput) {
                        clientSourceInput.value = this.textContent?.trim();
                    }
                });
            });

            // Back to top functionality
            const backToTopButton = document.querySelector('.sticky-top');
            if (backToTopButton) {
                backToTopButton.addEventListener('click', function() {
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                });

                // Show/hide back to top button based on scroll position
                window.addEventListener('scroll', function() {
                    if (window.pageYOffset > 300) {
                        backToTopButton.style.opacity = '1';
                        backToTopButton.style.visibility = 'visible';
                    } else {
                        backToTopButton.style.opacity = '0';
                        backToTopButton.style.visibility = 'hidden';
                    }
                });
            }

            // Location Map Filter functionality with smooth transitions
            const locationMapFilterButtons = document.querySelectorAll('.project-location .location-filters .filter-btn');
            const mapContainers = document.querySelectorAll('.map-container');
            const locationInfo = document.querySelector('.project-location__info');

            locationMapFilterButtons.forEach((button) => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons
                    locationMapFilterButtons.forEach(btn => btn.classList.remove('active'));
                    // Add active class to clicked button
                    this.classList.add('active');

                    const filterValue = this.getAttribute('data-filter');

                    // Add fade out effect to current map and location info
                    mapContainers.forEach(container => {
                        if (container.style.display !== 'none') {
                            container.style.opacity = '0';
                            container.style.transform = 'translateY(20px)';
                        }
                    });

                    if (locationInfo) {
                        locationInfo.style.opacity = '0';
                        locationInfo.style.transform = 'translateY(20px)';
                    }

                    // After fade out, switch containers and fade in
                    setTimeout(() => {
                        // Hide all map containers
                        mapContainers.forEach(container => {
                            container.style.display = 'none';
                            container.style.opacity = '0';
                            container.style.transform = 'translateY(20px)';
                        });

                        // Show selected map container with fade in
                        const targetContainer = document.getElementById(filterValue + '-container');
                        if (targetContainer) {
                            targetContainer.style.display = 'block';
                            // Force reflow
                            targetContainer.offsetHeight;
                            // Start fade in animation
                            setTimeout(() => {
                                targetContainer.style.opacity = '1';
                                targetContainer.style.transform = 'translateY(0)';
                            }, 50);
                        }

                        // Fade in location info with staggered animation for columns
                        if (locationInfo) {
                            setTimeout(() => {
                                locationInfo.style.opacity = '1';
                                locationInfo.style.transform = 'translateY(0)';

                                // Add staggered animation to location columns
                                const locationColumns = locationInfo.querySelectorAll('.location-column');
                                locationColumns.forEach((column, index) => {
                                    column.style.opacity = '0';
                                    column.style.transform = 'translateY(30px)';
                                    setTimeout(() => {
                                        column.style.opacity = '1';
                                        column.style.transform = 'translateY(0)';
                                    }, index * 150); // 150ms delay between each column
                                });
                            }, 100);
                        }
                    }, 300);
                });
            });

            // Gallery Filter functionality
            const galleryFilterButtons = document.querySelectorAll('.gallery-filters .filter-btn');
            const galleryItems = document.querySelectorAll('.gallery-card');

            galleryFilterButtons.forEach((button) => {
                button.addEventListener('click', function(e) {
                    // Remove active class from all buttons
                    galleryFilterButtons.forEach(btn => btn.classList.remove('active'));
                    // Add active class to clicked button
                    this.classList.add('active');

                    const filterValue = this.getAttribute('data-filter');

                    galleryItems.forEach((item) => {
                        const imageName = item.getAttribute('data-image-name') || '';
                        let shouldShow = false;

                        if (filterValue === 'all') {
                            shouldShow = true;
                        } else if (filterValue === 'facility') {
                            shouldShow = imageName.toLowerCase().includes('facility');
                        } else {
                            // Check for house type in both _housetype_ and -housetype- patterns
                            const lowerImageName = imageName.toLowerCase();
                            const lowerFilterValue = filterValue.toLowerCase();

                            // Pattern 1: _housetype_ (underscore pattern)
                            const underscorePattern = `_${lowerFilterValue}_`;
                            // Pattern 2: -housetype- (dash pattern)
                            const dashPattern = `-${lowerFilterValue}-`;

                            shouldShow = lowerImageName.includes(underscorePattern) || lowerImageName.includes(dashPattern);
                        }

                        if (shouldShow) {
                            item.classList.remove('gallery-hidden');
                        } else {
                            item.classList.add('gallery-hidden');
                        }
                    });

                    // Re-setup animations for visible items after filtering
                    setTimeout(() => {
                        setupGalleryAnimations();
                    }, 50);
                });
            });

            // Google reCAPTCHA v3 initialization and handling
            const recaptchaToken = document.getElementById('recaptchaToken');
            const recaptchaMessage = document.getElementById('recaptchaMessage');
            const registrationSubmitBtn = document.getElementById('registrationSubmitBtn');
            let recaptchaVerified = false;

            function executeRecaptcha() {
                if (typeof grecaptcha !== 'undefined') {
                    grecaptcha.ready(function() {
                        grecaptcha.execute('@ViewBag.RecaptchaSiteKey', { action: 'register' }).then(function(token) {
                            if (recaptchaToken) {
                                recaptchaToken.value = token;
                            }
                            recaptchaVerified = true;
                            if (recaptchaMessage) {
                                recaptchaMessage.textContent = 'Google reCAPTCHA - ยืนยันแล้ว ✓';
                            }
                            // Enable submit button once reCAPTCHA is verified
                            if (registrationSubmitBtn) {
                                registrationSubmitBtn.disabled = false;
                            }
                        }).catch(function(error) {
                            console.error('reCAPTCHA error:', error);
                            if (recaptchaMessage) {
                                recaptchaMessage.textContent = 'Google reCAPTCHA - เกิดข้อผิดพลาด';
                            }
                        });
                    });
                } else {
                    // If grecaptcha is not loaded, retry after a delay
                    setTimeout(executeRecaptcha, 1000);
                }
            }

            // Initialize reCAPTCHA when page loads
            executeRecaptcha();

            // Re-verify reCAPTCHA token periodically (every 2 minutes) to keep it fresh
            setInterval(executeRecaptcha, 120000);

            // Registration form submission handling with AJAX
            const registrationForm = document.getElementById('registrationForm');
            if (registrationForm) {
                registrationForm.addEventListener('submit', function(e) {
                    e.preventDefault(); // Prevent default form submission

                    // Check if reCAPTCHA is verified
                    if (!recaptchaVerified || !recaptchaToken.value) {
                        showValidationErrors(['กรุณารอให้ Google reCAPTCHA ตรวจสอบเสร็จสิ้น']);
                        return;
                    }

                    // Check if form validation passes
                    if (this.checkValidity()) {
                        // Hide any previous validation errors
                        hideValidationErrors();
                        
                        // Show loading state on submit button
                        const submitButton = document.getElementById('registrationSubmitBtn');
                        const btnText = submitButton ? submitButton.querySelector('.btn-text') : null;
                        const btnSpinner = submitButton ? submitButton.querySelector('.btn-spinner') : null;

                        if (submitButton) {
                            submitButton.disabled = true;
                            if (btnText) btnText.style.display = 'none';
                            if (btnSpinner) btnSpinner.style.display = 'inline-block';
                        }

                        // Prepare form data
                        const formData = new FormData(this);

                        // Submit form via AJAX
                        console.log('Submitting form via AJAX to:', this.action);
                        fetch(this.action, {
                            method: 'POST',
                            body: formData,
                            headers: {
                                'X-Requested-With': 'XMLHttpRequest'
                            }
                        })
                        .then(response => {
                            console.log('Response received:', response.status);
                            return response.json();
                        })
                        .then(data => {
                            console.log('JSON data received:', data);
                            if (data.success) {
                                // Update modal project name
                                const modalProjectName = document.getElementById('modalProjectName');
                                if (modalProjectName && data.projectName) {
                                    modalProjectName.textContent = data.projectName;
                                }

                                // Track registration success event in GTM
                                if (typeof gtag !== 'undefined') {
                                    gtag('event', 'registration_success', {
                                        'event_category': 'engagement',
                                        'event_label': data.projectName || 'Unknown Project',
                                        'project_id': '@Model.Id',
                                        'project_name': data.projectName,
                                        'registration_method': 'modal'
                                    });
                                }

                                // Track with dataLayer if available
                                if (typeof dataLayer !== 'undefined') {
                                    dataLayer.push({
                                        'event': 'registration_success',
                                        'eventCategory': 'engagement',
                                        'eventAction': 'form_submit',
                                        'eventLabel': data.projectName,
                                        'projectId': '@Model.Id',
                                        'projectName': data.projectName,
                                        'registrationMethod': 'modal'
                                    });
                                }

                                // Show success modal
                                $('#registrationSuccessModal').modal('show');

                                // Track modal view event
                                if (typeof gtag !== 'undefined') {
                                    gtag('event', 'modal_view', {
                                        'event_category': 'engagement',
                                        'event_label': 'registration_success_modal',
                                        'project_id': '@Model.Id'
                                    });
                                }

                                // Reset form
                                this.reset();
                            } else {
                                // Track registration error
                                if (typeof gtag !== 'undefined') {
                                    gtag('event', 'registration_error', {
                                        'event_category': 'engagement',
                                        'event_label': data.message || 'Unknown Error',
                                        'project_id': '@Model.Id'
                                    });
                                }

                                // Show validation errors in minimalist panel
                                showValidationErrors(data.errors || [data.message || 'เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง']);
                            }
                        })
                        .catch(error => {
                            console.error('Registration error:', error);
                            showValidationErrors(['เกิดข้อผิดพลาดในการเชื่อมต่อ กรุณาลองใหม่อีกครั้ง']);
                        })
                        .finally(() => {
                            // Restore submit button
                            if (submitButton) {
                                submitButton.disabled = false;
                                if (btnText) btnText.style.display = 'inline-block';
                                if (btnSpinner) btnSpinner.style.display = 'none';
                            }
                        });
                    }
                });
            }
        });

    </script>

    <style>
        /* Registration Success Modal Styles */
        #registrationSuccessModal .modal-header {
            border: none;
            padding: 30px 30px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        #registrationSuccessModal .success-icon {
            width: 80px;
            height: 80px;
            background: #365523;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0;
        }

        #registrationSuccessModal .success-icon i {
            color: white;
            font-size: 36px;
        }

        #registrationSuccessModal .close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 28px;
            font-weight: normal;
            color: #999;
            text-shadow: none;
            opacity: 0.8;
        }

        #registrationSuccessModal .close:hover {
            opacity: 1;
            color: #666;
        }

        #registrationSuccessModal .modal-body {
            padding: 20px 30px 30px;
        }

        #registrationSuccessModal .success-title {
            color: #365523;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        #registrationSuccessModal .success-message {
            color: #666;
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        #registrationSuccessModal .success-message p {
            margin-bottom: 8px;
        }

        #registrationSuccessModal .success-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 25px;
        }

        #registrationSuccessModal .btn-primary {
            background: #365523;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        #registrationSuccessModal .btn-primary:hover {
            background: #1e7e34;
            color: white;
            text-decoration: none;
        }

        #registrationSuccessModal .btn-secondary {
            background: transparent;
            color: #666;
            padding: 12px 24px;
            border: 2px solid #afb5b2;
            border-radius: 25px;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        #registrationSuccessModal .btn-secondary:hover {
            background: #61676d;
            color: white;
            text-decoration: none;
        }

        #registrationSuccessModal .social-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        #registrationSuccessModal .btn-line,
        #registrationSuccessModal .btn-facebook,
        #registrationSuccessModal .btn-phone {
            background: #afb5b2;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        #registrationSuccessModal .btn-line:hover,
        #registrationSuccessModal .btn-facebook:hover,
        #registrationSuccessModal .btn-phone:hover {
            background: #9ba19e;
            color: white;
            text-decoration: none;
        }

        @@media (max-width: 768px) {
            #registrationSuccessModal .modal-dialog {
                margin: 10px;
            }

            #registrationSuccessModal .success-actions {
                flex-direction: column;
                align-items: center;
            }

            #registrationSuccessModal .btn-primary,
            #registrationSuccessModal .btn-secondary {
                width: 100%;
                max-width: 250px;
            }

            #registrationSuccessModal .social-buttons {
                flex-direction: column;
                align-items: center;
            }

            #registrationSuccessModal .btn-line,
            #registrationSuccessModal .btn-facebook,
            #registrationSuccessModal .btn-phone {
                width: 100%;
                max-width: 240px;
                justify-content: center;
            }
        }

        /* Spinner Animation for Submit Button */
        @@keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .btn-spinner {
            display: inline-block;
            margin-left: 8px;
        }

        .spinner-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        #registrationSubmitBtn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        #registrationSubmitBtn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #999 !important;
            color: #fff !important;
        }

        #registrationSubmitBtn:not(:disabled) {
            opacity: 1;
            transition: all 0.3s ease;
        }

        #registrationSubmitBtn:hover:not(:disabled) {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Project Theme Colors */
        :root {
            --project-primary: #C2185B;
            --project-secondary: #E91E63;
            --project-light-bg: #FCE4EC;
        }

        /* Gallery animation styles */
        .gallery-card {
            opacity: 0;
            transform: translateY(20px) scale(0.95);
        }

        .gallery-card.animate {
            animation: fadeInGalleryItem 0.6s ease-out forwards;
        }

        .gallery-card:not(.gallery-hidden) {
            transition: all 0.8s ease-in-out !important;
        }

        .gallery-grid {
            opacity: 1;
        }

        @@keyframes fadeInGalleryItem {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }


        /* Smooth filter animation */
        .gallery-hidden {
            opacity: 0 !important;
            transform: scale(0.7) translateY(30px) !important;
            transition: all 0.8s ease-in-out !important;
        }

        /* Map and Location Info Smooth Transitions */
        .map-container {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            opacity: 1;
            transform: translateY(0);
        }

        .project-location__info {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            opacity: 1;
            transform: translateY(0);
        }

        .location-grid {
            transition: all 0.4s ease-in-out;
        }

        .location-column {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            opacity: 1;
            transform: translateY(0);
        }

        .location-category {
            transition: all 0.3s ease-in-out;
        }

        .location-category:hover {
            transform: translateY(-2px);
        }

        /* Project Details Section - Use dynamic primary color to match registration button */
        #details,
        section#details,
        section.project-section#details,
        section.project-section.project-details#details,
        .project-section.project-details,
        .project-details {
            background-color: var(--primary-color) !important;
            background: var(--primary-color) !important;
            color: white !important;
            border-radius: 0 !important;
        }

        /* Project Details Grid */
        .project-details__grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            padding: 40px 20px;
            max-width: 1200px;
            margin: 0 auto;
            opacity: 0;
            transform: translateY(20px) scale(0.95);
            transition: all 0.6s ease-out;
        }

        .project-details__grid.animate-in {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        /* Animation Keyframes */
        @@keyframes fadeInUp {
            0% {
                opacity: 0;
                transform: translateY(30px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @@keyframes slideInScale {
            0% {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Detail Card Styling */
        .detail-card {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }

        .detail-card.animate-in {
            opacity: 1;
            transform: translateY(0);
        }

        /* Staggered Animation Delays */
        .detail-card:nth-child(1).animate-in { transition-delay: 0.1s; }
        .detail-card:nth-child(2).animate-in { transition-delay: 0.2s; }
        .detail-card:nth-child(3).animate-in { transition-delay: 0.3s; }
        .detail-card:nth-child(4).animate-in { transition-delay: 0.4s; }
        .detail-card:nth-child(5).animate-in { transition-delay: 0.5s; }
        .detail-card:nth-child(6).animate-in { transition-delay: 0.6s; }
        .detail-card:nth-child(7).animate-in { transition-delay: 0.7s; }
        .detail-card:nth-child(8).animate-in { transition-delay: 0.8s; }
        .detail-card:nth-child(9).animate-in { transition-delay: 0.9s; }
        .detail-card:nth-child(10).animate-in { transition-delay: 1.0s; }

        .detail-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .detail-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .detail-icon i {
            font-size: 20px;
            color: white !important;
        }

        .detail-content {
            flex: 1;
        }

        .detail-label {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.8) !important;
            margin-bottom: 5px;
            font-weight: 400;
        }

        .detail-value {
            font-size: 16px;
            color: white !important;
            font-weight: 600;
            line-height: 1.3;
        }

        /* Ensure all text elements inside project details are white */
        #details *,
        section#details *,
        .project-details *,
        .project-details h2,
        .project-details h3,
        .project-details p,
        .project-details li,
        .project-details span,
        .project-details div,
        .project-details .details-definition *,
        .project-details__content *,
        .project-details__content-left *,
        .details-label,
        .details-value {
            color: white !important;
        }

        /* Override any nth-child or other selectors */
        #details:nth-of-type(even),
        #details:nth-of-type(odd),
        section#details:nth-of-type(even),
        section#details:nth-of-type(odd),
        section.project-section#details:nth-of-type(even),
        section.project-section#details:nth-of-type(odd) {
            background-color: var(--primary-color) !important;
            background: var(--primary-color) !important;
            color: white !important;
            border-radius: 0 !important;
        }

        /* Project Details Visual Right Container */
        .project-details__visual-right {
            margin-right: 20px;
        }

        /* Project Details Single Thumbnail */
        .project-details__thumbnail {
            width: 100%;
            height: 380px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .project-details__thumbnail:hover {
            transform: scale(1.03);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.18);
        }

        .project-details__thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .project-details__thumbnail:hover img {
            transform: scale(1.05);
        }

        /* Responsive adjustments for single thumbnail */
        @@media (max-width: 1200px) {
            .project-details__thumbnail {
                height: 320px;
            }
        }

        @@media (max-width: 768px) {
            .project-details__thumbnail {
                height: 280px;
            }
        }

        /* Concept Cards Styling */
        .concept-section {
            background: linear-gradient(135deg, #e91e63 0%, #f06292 50%, #f8bbd9 100%);
            padding: 60px 20px;
            margin: 60px 0;
        }

        .concept-header {
            text-align: center;
            margin-bottom: 50px;
        }

        .concept-main-title {
            font-size: 48px;
            font-weight: 700;
            color: #2d3436;
            margin-bottom: 15px;
            font-family: 'Prompt', sans-serif;
        }

        .concept-subtitle {
            font-size: 18px;
            color: #636e72;
            margin: 0;
            font-weight: 300;
        }

        .concept-cards-grid {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 30px;
            padding: 0;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s ease-out;
            max-width: 1400px;
            margin: 0 auto;
            flex-wrap: wrap;
        }

        .concept-cards-grid.animate-in {
            opacity: 1;
            transform: translateY(0);
        }

        .concept-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
            flex: 1 1 auto;
            min-width: 250px;
        }

        .concept-card.animate-in {
            opacity: 1;
            transform: translateY(0);
        }

        .concept-card:nth-child(1).animate-in { transition-delay: 0.1s; }
        .concept-card:nth-child(2).animate-in { transition-delay: 0.2s; }
        .concept-card:nth-child(3).animate-in { transition-delay: 0.3s; }

        .concept-card__image {
            height: 200px;
            overflow: hidden;
            border-radius: 20px 20px 0 0;
        }

        .concept-card__image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .concept-card__placeholder {
            height: 200px;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #dee2e6;
            font-size: 14px;
        }

        .concept-card__content {
            padding: 25px 20px;
            text-align: center;
        }

        .concept-card__title {
            font-size: 20px;
            font-weight: 600;
            color: #2d3436;
            margin-bottom: 12px;
            line-height: 1.3;
            font-family: 'Prompt', sans-serif;
        }

        .concept-card__description {
            font-size: 15px;
            color: #636e72;
            line-height: 1.5;
            margin: 0;
            font-weight: 300;
        }

        /* Responsive Design for Concept Cards */
        @@media (max-width: 992px) {
            .concept-main-title {
                font-size: 40px;
            }

            .concept-cards-grid {
                gap: 20px;
            }

            .concept-card {
                flex: 1 1 auto;
                min-width: 280px;
            }
        }

        @@media (max-width: 768px) {
            .concept-section {
                padding: 40px 15px;
                margin: 40px 0;
            }

            .concept-main-title {
                font-size: 32px;
            }

            .concept-subtitle {
                font-size: 16px;
            }

            .concept-cards-grid {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }

            .concept-card {
                flex: none;
                width: 100%;
                max-width: 350px;
                min-width: auto;
            }

            .concept-card__image {
                height: 200px;
            }

            .concept-card__content {
                padding: 25px 20px;
            }

            .concept-card__title {
                font-size: 20px;
            }

            .concept-card__description {
                font-size: 15px;
            }
        }

        /* Responsive Design for Project Details Grid */
        @@media (max-width: 768px) {
            .project-details__grid {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 30px 15px;
            }

            .detail-card {
                padding: 15px;
            }

            .detail-icon {
                width: 40px;
                height: 40px;
                margin-right: 12px;
            }

            .detail-icon i {
                font-size: 18px;
            }

            .detail-label {
                font-size: 15px;
            }

            .detail-value {
                font-size: 16px;
            }
        }

        @@media (max-width: 480px) {
            .project-details__grid {
                padding: 20px 10px;
                gap: 12px;
            }

            .detail-card {
                padding: 12px;
            }

            .detail-icon {
                width: 35px;
                height: 35px;
                margin-right: 10px;
            }

            .detail-icon i {
                font-size: 16px;
            }
        }

        @@media (max-width: 480px) {
            .project-details__thumbnail {
                height: 240px;
            }
        }

        /* Gallery Modal Styles */
        .gallery-modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px);
        }

        .gallery-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: modalFadeIn 0.3s ease-out;
        }

        .gallery-modal-content {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 60px 24px;
            box-sizing: border-box;
        }

        .gallery-modal-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .gallery-modal-close {
            position: absolute;
            top: 24px;
            right: 24px;
            background: none;
            border: none;
            color: white;
            font-size: 32px;
            font-weight: 400;
            cursor: pointer;
            z-index: 10000;
            width: 44px;
            height: 44px;
            transition: all 0.25s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .gallery-modal-close:hover {
            color: rgba(255, 255, 255, 0.8);
            transform: scale(1.1);
        }

        .gallery-modal-prev,
        .gallery-modal-next {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.95);
            border: none;
            color: #2c3e50;
            font-size: 20px;
            font-weight: 400;
            cursor: pointer;
            width: 48px;
            height: 48px;
            border-radius: 24px;
            transition: all 0.25s cubic-bezier(0.4, 0.0, 0.2, 1);
            backdrop-filter: blur(20px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

        .gallery-modal-prev {
            left: 24px;
        }

        .gallery-modal-next {
            right: 24px;
        }

        .gallery-modal-prev:hover,
        .gallery-modal-next:hover {
            background: rgba(255, 255, 255, 1);
            color: #1a252f;
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.2);
        }

        .gallery-modal-counter {
            position: absolute;
            bottom: -50px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 16px;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 16px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        @@keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Mobile responsive */
        @@media (max-width: 768px) {
            .gallery-modal-prev {
                left: 15px;
                font-size: 24px;
                padding: 16px 20px;
                background: rgba(0, 0, 0, 0.8);
                border: 2px solid rgba(255, 255, 255, 0.4);
            }

            .gallery-modal-next {
                right: 15px;
                font-size: 24px;
                padding: 16px 20px;
                background: rgba(0, 0, 0, 0.8);
                border: 2px solid rgba(255, 255, 255, 0.4);
            }

            .gallery-modal-close {
                top: 15px;
                right: 15px;
                font-size: 28px;
                padding: 14px 18px;
                background: rgba(0, 0, 0, 0.8);
                border: 2px solid rgba(255, 255, 255, 0.4);
            }

            .gallery-modal-counter {
                bottom: 20px;
                font-size: 14px;
                background: rgba(0, 0, 0, 0.8);
                border: 1px solid rgba(255, 255, 255, 0.3);
            }
        }

        /* Location Grid Styles */
        .location-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-top: 32px;
        }

        .location-column {
            background: transparent;
            padding: 24px;
        }

        .location-category {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .category-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--primary-color, #365523);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            flex-shrink: 0;
        }

        .category-icon i {
            color: white;
            font-size: 20px;
        }

        .category-icon .icon-nearby {
            width: 28px;
            height: 28px;
            color: white;
        }

        .category-icon-img {
            width: 28px;
            height: 28px;
            object-fit: contain;
            filter: brightness(0) invert(1);
        }

        .location-category h4 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .location-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .location-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
        }

        .place-name {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }

        .place-distance {
            font-size: 14px;
            color: #666;
            font-weight: 400;
        }

        @@media (max-width: 1024px) {
            .location-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
        }

        @@media (max-width: 768px) {
            .location-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
}

<!-- Sticky Social Media Buttons -->
<div class="sticky-social-buttons">
    <a href="https://line.me/R/ti/p/@@ppsasset" class="sticky-social-button sticky-line" target="_blank" aria-label="LINE">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63h2.386c.349 0 .63.285.63.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63.349 0 .631.285.631.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12.017.572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/>
        </svg>
    </a>

    <a href="https://facebook.com/ppsasset" class="sticky-social-button sticky-facebook" target="_blank" aria-label="Facebook">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
        </svg>
    </a>

    <button type="button" class="sticky-social-button sticky-top" aria-label="Back to top">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
        </svg>
    </button>
</div>

<script>
    // Intersection Observer for scroll-triggered animations
    document.addEventListener('DOMContentLoaded', function() {
        // Create intersection observer with options
        const observerOptions = {
            threshold: 0.1,  // Trigger when 10% of element is visible
            rootMargin: '0px 0px -50px 0px'  // Trigger 50px before element comes into view
        };

        const observer = new IntersectionObserver(function(entries) {
            entries.forEach(function(entry) {
                if (entry.isIntersecting) {
                    // Add animation class when element comes into view
                    entry.target.classList.add('animate-in');

                    // If it's the project details grid container, also animate its children with staggered delays
                    if (entry.target.classList.contains('project-details__grid')) {
                        const cards = entry.target.querySelectorAll('.detail-card');
                        cards.forEach(function(card, index) {
                            setTimeout(function() {
                                card.classList.add('animate-in');
                            }, 200 + (index * 100)); // 200ms base delay + 100ms per card
                        });
                    }

                    // If it's the concept cards grid container, animate its children with staggered delays
                    if (entry.target.classList.contains('concept-cards-grid')) {
                        const conceptCards = entry.target.querySelectorAll('.concept-card');
                        conceptCards.forEach(function(card, index) {
                            setTimeout(function() {
                                card.classList.add('animate-in');
                            }, 300 + (index * 150)); // 300ms base delay + 150ms per card
                        });
                    }

                    // Stop observing once animated
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        // Observe the project details grid container
        const projectGrid = document.querySelector('.project-details__grid');
        if (projectGrid) {
            observer.observe(projectGrid);
        }

        // Observe the concept cards grid
        const conceptGrid = document.querySelector('.concept-cards-grid');
        if (conceptGrid) {
            observer.observe(conceptGrid);
        }

        // Also observe any other sections that might have animations
        const animatedSections = document.querySelectorAll('.house-content, .contact-info-section');
        animatedSections.forEach(function(section) {
            observer.observe(section);
        });
    });
</script>
